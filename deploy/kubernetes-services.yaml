apiVersion: v1
kind: Service
metadata:
  name: whisper-streaming-serve-svc
  namespace: default
spec:
  ports:
    - name: http
      port: 8000
      protocol: TCP
      targetPort: 8000
  selector:
    component: ray-head
    rayservice: whisper-streaming
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: whisper-streaming-head-svc
  namespace: default
spec:
  ports:
    - name: gcs
      port: 6379
      protocol: TCP
      targetPort: 6379
    - name: dashboard
      port: 8265
      protocol: TCP
      targetPort: 8265
    - name: client
      port: 10001
      protocol: TCP
      targetPort: 10001
    - name: redis
      port: 6380
      protocol: TCP
      targetPort: 6380
    - name: metrics
      port: 8080
      protocol: TCP
      targetPort: 8080
    - name: serve
      port: 8000
      protocol: TCP
      targetPort: 8000
  selector:
    component: ray-head
    rayservice: whisper-streaming
  type: ClusterIP
---
# Service account for Ray clusters
apiVersion: v1
kind: ServiceAccount
metadata:
  name: ray-cluster-service-account
  namespace: default
---
# RBAC for the service account
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: ray-cluster-role
  namespace: default
rules:
  - apiGroups: [ "" ]
    resources: [ "pods", "services" ]
    verbs: [ "get", "watch", "list", "create", "delete", "patch" ]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: ray-cluster-role-binding
  namespace: default
subjects:
  - kind: ServiceAccount
    name: ray-cluster-service-account
    namespace: default
roleRef:
  kind: Role
  name: ray-cluster-role
  apiGroup: rbac.authorization.k8s.io